import {MorphPoint, Morpher, loadImageData} from '../../build';

const imageAPoints = [
  258.836914,
  613.183472,
  265.841003,
  671.250977,
  275.065002,
  709.225098,
  287.296997,
  746.401062,
  304.249023,
  781.597961,
  326.65802,
  813.661926,
  353.343048,
  842.419006,
  382.968048,
  868.009949,
  414.973938,
  891.070923,
  458.33374,
  903.639099,
  497.294647,
  892.327759,
  527.458008,
  870.33374,
  552.099976,
  842.042908,
  577.780029,
  813.17804,
  599.01001,
  780.958069,
  614.629944,
  745.771973,
  625.290222,
  708.62207,
  632.900146,
  670.724976,
  637.679871,
  613.092529,
  286.942993,
  549.355957,
  316.385986,
  544.48999,
  346.209991,
  543.457031,
  375.771973,
  546.028076,
  405.254913,
  547.414978,
  379.638977,
  526.710022,
  345.959961,
  522.208008,
  312.253967,
  526.519043,
  613.879944,
  549.44812,
  583.78009,
  544.739014,
  553.230042,
  544.228027,
  523.044067,
  547.515991,
  492.996002,
  549.43396,
  518.794983,
  528.356018,
  552.910217,
  523.437988,
  587.25,
  527.302979,
  323.842041,
  597.23584,
  339.531982,
  605.275024,
  358.070984,
  608.580933,
  376.845001,
  606.432983,
  394.636017,
  600.671021,
  381.191254,
  584.384888,
  360.907623,
  578.489746,
  339.83075,
  582.991943,
  359.390991,
  594.722778,
  361.242035,
  590.123047,
  576.150024,
  596.746704,
  560.560059,
  605.575012,
  541.890137,
  609.133057,
  523.003113,
  606.862061,
  505.120941,
  600.874023,
  518.310913,
  584.181885,
  538.669495,
  578.225769,
  559.957031,
  582.649292,
  540.416138,
  594.72937,
  538.339966,
  590.729004,
  422.552551,
  601.924072,
  424.066193,
  672.570618,
  400.909973,
  712.33905,
  429.427216,
  720.145508,
  453.309998,
  731.070068,
  475.300629,
  720.773926,
  503.749023,
  711.129028,
  480.40567,
  671.797974,
  477.794983,
  602.025513,
  453.357971,
  698.972961,
  394.611023,
  787.008972,
  511.873962,
  783.843933,
  408.528046,
  808.775085,
  428.919952,
  824.944092,
  454.919922,
  829.890076,
  479.926056,
  823.739075,
  499.179962,
  806.520935,
  483.907013,
  791.179016,
  455.260986,
  797.129089,
  424.524536,
  792.786011,
  415.359039,
  774.908081,
  438.927002,
  766.62085,
  455.97699,
  771.594116,
  471.924042,
  766.315002,
  493.246063,
  773.796021,
  483.529022,
  786.841003,
  455.426971,
  790.815979,
  425.322968,
  788.329407,
  450.173737,
  601.974731,
  449.12561,
  548.424561,
  454.643463,
  751.33197,
  294.340942,
  352.052673,
  452.285553,
  422.855225,
  600.200012,
  351.450378,
  447.037384,
  472.879456,
  264.159851,
  554.286255,
  631.237854,
  555.076294,
  540.162415,
  442.977295,
  606.83606,
  490.365845,
  448.772308,
  425.595886,
  356.454742,
  442.871216,
  288.88855,
  489.970581,
];

const imageBPoints = [
  263.798523,
  624.116943,
  272.742981,
  679.658997,
  283.106995,
  715.783997,
  296.257996,
  751.103027,
  314.030029,
  784.267944,
  337.099976,
  814.052002,
  363.963989,
  840.520996,
  393.01001,
  864.14801,
  424.95697,
  882.799988,
  461.483002,
  889.309998,
  497.182983,
  880.210022,
  527.604004,
  859.830994,
  555.170044,
  835.022034,
  580.209961,
  807.27301,
  600.98999,
  776.272949,
  615.939941,
  742.153931,
  625.969971,
  706.072021,
  633.439941,
  669.331909,
  638.344971,
  613.455933,
  292.286011,
  556.328003,
  322.116028,
  556.255005,
  352.342041,
  558.699951,
  382.357056,
  563.03302,
  412.40802,
  565.237976,
  386.955933,
  544.398987,
  353.887939,
  538.649048,
  320.421021,
  538.218994,
  611.640137,
  552.493042,
  579.660034,
  551.216003,
  547.290039,
  553.70697,
  515.340088,
  559.280029,
  483.344086,
  563.041016,
  509.41806,
  540.24707,
  544.429932,
  533.952026,
  580.119995,
  534.254028,
  329.354004,
  606.451538,
  344.055969,
  616.458984,
  362.520996,
  621.146973,
  381.601013,
  619.346985,
  399.695007,
  613.268066,
  387.16449,
  596.616882,
  367.207275,
  590.295776,
  346.108032,
  593.704346,
  364.786865,
  606.36438,
  368.71405,
  603.088989,
  575.930054,
  601.051392,
  561.780029,
  612.044067,
  543.410034,
  617.715088,
  524.044922,
  616.981995,
  505.312073,
  612.258057,
  517.052734,
  594.408691,
  536.940552,
  586.19397,
  558.702026,
  588.408203,
  540.293457,
  602.818848,
  539.700073,
  600.253052,
  425.908447,
  613.44397,
  426.255127,
  687.694824,
  405.679993,
  724.705017,
  432.059998,
  737.906982,
  453.241058,
  745.148743,
  474.133362,
  734.702576,
  501.989746,
  723.385864,
  479.356415,
  683.342285,
  478.717133,
  612.938965,
  451.5,
  712.939697,
  401.776978,
  793.664978,
  510.916962,
  789.392029,
  415.711975,
  810.836975,
  434.153961,
  822.638,
  456.083984,
  825.741943,
  478.724976,
  821.204956,
  497.583008,
  808.090027,
  482.849945,
  797.572998,
  451.5,
  798.25,
  427.56897,
  799.333008,
  418.330017,
  784.461914,
  437.166992,
  778.393982,
  453.021973,
  782.133972,
  468.442963,
  777.052002,
  490.68103,
  781.893005,
  481.967957,
  795.638428,
  454.09201,
  795.778076,
  426.255127,
  796.508911,
  451.5,
  612.830811,
  447.876038,
  564.139526,
  455.03653,
  762.526489,
  294.743958,
  372.382111,
  449.031799,
  465.361938,
  596.689941,
  367.080902,
  447.574554,
  483.463928,
  268.038818,
  567.242188,
  628.749756,
  557.248352,
  536.515015,
  450.268921,
  604.037354,
  495.493164,
  443.97052,
  433.681274,
  355.993835,
  451.610535,
  291.604675,
  500.492432,
];

main().catch(console.error);

async function main() {
  let imageA = document.getElementById('image-a') as HTMLImageElement;
  let imageB = document.getElementById('image-b') as HTMLImageElement;

  let dataA = loadImageData(imageA, 900, 1600);
  let dataB = loadImageData(imageB, 900, 1600);

  let pointsA = buildPointsFromArray(imageAPoints);

  let pointsB = buildPointsFromArray(imageBPoints);

  let morpher = new Morpher(
    {imageData: dataA, points: pointsA},
    {imageData: dataB, points: pointsB},
  );

  let result = morpher.morph(0.4);

  let canvas = document.getElementById('output-canvas') as HTMLCanvasElement;

  let context = canvas.getContext('2d')!;

  context.putImageData(result, 0, 0);

  // context.strokeStyle = '#ff0000';
  // context.beginPath();
  // context.arc(50, 50, 10, 0, 2 * Math.PI);
  // context.stroke();

  // for (let point of pointsA) {
  //   context.strokeStyle = '#ff0000';
  //   context.beginPath();
  //   context.arc(point.x, point.y, 10, 0, 2 * Math.PI);
  //   context.stroke();
  // }
}

function buildPointsFromArray(arr: number[]): MorphPoint[] {
  let points: MorphPoint[] = [];

  arr = [...arr];

  while (arr.length) {
    let [a, b] = arr.splice(0, 2);

    if (a && b) {
      points.push({x: a, y: b});
    }
  }

  return points;
}
